import "tfplan/v2" as tfplan

# Get all EC2 instances from plan
instances = tfplan.resource_changes.where(type == "aws_instance")

# Identify invalid instance types
invalid = instances.where(
  not (change.after.instance_type matches "^t[34]\\..*")
)

main = rule {
  invalid is empty
}
