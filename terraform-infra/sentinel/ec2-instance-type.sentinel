import "tfplan/v2" as tfplan

allowed_types = [
  "t2.micro",
  "t3.micro",
  "t3.small",
]

ec2_instances = filter tfplan.resource_changes as _, rc {
    rc.type == "aws_instance" and
    rc.change.after["instance_type"] is not null
}

valid_instance_types = rule {
  all ec2_instances as _, inst {
    inst.change.after["instance_type"] in allowed_types
  }
}

main = rule {
  valid_instance_types
}
