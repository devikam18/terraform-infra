import "tfplan/v2" as tfplan

allowed_types = [
  "t2.micro",
  "t3.micro",
  "t3.small",
]

ec2_resources = filter tfplan.resource_changes as _, rc {
    rc.type is "aws_instance" and
    rc.change.after contains key "instance_type"
}

# Check instance type
valid_instance_types = rule {
  all ec2_resources as _, r {
    r.change.after.instance_type in allowed_types
  }
}

main = rule {
  valid_instance_types
}
