import "tfplan/v2" as tfplan

required_tags = [
  "Name",
  "Environment",
  "Owner",
]

all_resources = filter tfplan.resource_changes as _, rc {
  rc.change.after contains key "tags"
}

tags_present = rule {
  all all_resources as _, res {
    all required_tags as t {
      res.change.after.tags contains key t
    }
  }
}

main = rule {
  tags_present
}
