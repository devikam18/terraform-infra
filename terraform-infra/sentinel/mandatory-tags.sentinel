iimport "tfplan/v2" as tfplan

required_tags = [
  "Name",
  "Environment",
  "Owner",
]

resources_with_tags = filter tfplan.resource_changes as _, rc {
  rc.change.after["tags"] is not null
}

check_tags = rule {
  all resources_with_tags as _, res {
    all required_tags as t {
      res.change.after["tags"][t] is not null
    }
  }
}

main = rule {
  check_tags
}
